/* 
  fcbkListSelection 1.10 M1
  Jquery version required: 1.2.x - 1.6.x

  Changelog:
   - 1.1 M1 : height/expand/showtabs/allbtn/selectall options added, converted code to work as a more universal plugin.
   - 1.1: added preselected items
   - 1.0: project started

  Original by: emposha <admin@emposha.com>
  M1 Update by: an0nz
  Copyright: Emposha.com <http://www.emposha.com/> Distributed under MIT - Keep this message!
  */
  (function($){$.fn.fcbkListSelection=function(method){var hiddenCheck=function(a,b){switch(curTab()){case"all":a.children("li").show();break;case"selected":a.children("li:not([addedid])").hide();a.children("li[addedid]").show();break;case"unselected":a.children("li[addedid]").hide();a.children("li:not([addedid])").show();break}};var addAll=function(a,b){if(b){a.prepend('<li title="'+b+'">'+b+"</li>")}};var addToSelected=function(a,b){if(b.hasClass("itemselected")){$("#view_selected_count").text(parseInt($("#view_selected_count").text(),10)-1);b.parents("li").removeAttr("addedid");removeValue(a,b)}else{$("#view_selected_count").text(parseInt($("#view_selected_count").text(),10)+1);b.parents("li").attr("addedid","true");addValue(a,b)}hiddenCheck(a,b)};var addValue=function(a,b,c){var d=a.attr("id")+"_values";if($("#"+d).length==0){var e=document.createElement("input");$(e).attr({type:"hidden",name:d,id:d,value:""});a.after(e)}else{var e=$("#"+d)}var f="rand_"+randomId();if(!c){c=b.find("[type=hidden]").val();b.find("[type=hidden]").attr("randid",f)}var g=new data(f,c);var h=jsToString(g,$(e).val());$(e).val(h);return e};var removeValue=function(elem,obj){var randid=obj.find("[type=hidden]").attr("randid");var inputid=elem.attr("id")+"_values";if($("#"+inputid).length!=0){try{eval("json = "+$("#"+inputid).val()+";");var string="{";$.each(json,function(a,b){if(a&&b&&a!=randid){string+='"'+a+'":"'+b+'",'}});if(string.length>2){string=string.substr(0,string.length-1);string+="}"}else{string=""}$("#"+inputid).val(string)}catch(e){}}};var toggleAllButton=function(a,b,c){var d=a.children("li").eq(0).children(".fcbklist_item");if(b){var e=true;$.each(a.children("li").children(".fcbklist_item"),function(a,b){b=$(b);if(!b.hasClass("itemselected")&&c&&b.parents("li[title='"+c+"']").length==0){e=false}});if(e){addToSelected(a,d);d.addClass("itemselected");d.parents("li").addClass("liselected")}}else if(d.hasClass("itemselected")){addToSelected(a,d);d.removeClass("itemselected");d.parents("li").removeClass("liselected")}};var curTab=function(){return $(".view_on").attr("id").replace("view_","")};var data=function(id,value){try{eval("this."+id+" = value;")}catch(e){}};var jsToString=function(jsdata,json){var string="{";$.each(jsdata,function(a,b){if(a){string+='"'+a+'":"'+b+'",'}});try{eval("json = "+json+";");$.each(json,function(a,b){if(a&&b){string+='"'+a+'":"'+b+'",'}})}catch(e){}string=string.substr(0,string.length-1);string+="}";return string};var randomId=function(){var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";var b=32;var c="";for(var d=0;d<b;d++){var e=Math.floor(Math.random()*a.length);c+=a.substring(e,e+1)}return c};var methods={init:function(a){return this.each(function(){var b=$.extend({},$.fn.fcbkListSelection.settings,a);var c=function(a,b){switch(b){case"all":a.children("li").show();break;case"selected":a.children("li:not([addedid])").hide();a.children("li[addedid]").show();break;case"unselected":a.children("li[addedid]").hide();a.children("li:not([addedid])").show();break}};var d=function(a){var c=0;var d=0;$.each(a.children("li").children(".fcbklist_item"),function(f,g){g=$(g);if(b.selectAll){addToSelected(a,g);g.toggleClass("itemselected");g.parents("li").toggleClass("liselected")}else if(g.children("input[alt='checked']").length!=0){addToSelected(a,g);g.toggleClass("itemselected");g.parents("li").toggleClass("liselected");d++}if(g.parents("li[title='"+b.allBtnTxt+"']").length==0){c++}g.click(function(){if(b.allBtnTxt&&g.parents("li[title='"+b.allBtnTxt+"']").length!=0){e(a,g.hasClass("itemselected"),b.allBtnTxt)}else{addToSelected(a,g);g.toggleClass("itemselected");g.parents("li").toggleClass("liselected");if(b.allBtnTxt){toggleAllButton(a,g.hasClass("itemselected"),b.allBtnTxt)}}});g.mouseover(function(){g.addClass("itemover")});g.mouseout(function(){$(".itemover").removeClass("itemover")})});if(!b.selectAll&&b.allBtnTxt&&c==d){toggleAllButton(a,true,b.allBtnTxt)}};var e=function(a,b,c){$.each(a.children("li").children(".fcbklist_item"),function(c,d){d=$(d);if(d.hasClass("itemselected")==b){addToSelected(a,d);d.toggleClass("itemselected");d.parents("li").toggleClass("liselected")}})};var f=function(a){$.each($("#selections li"),function(b,d){d=$(d);d.click(function(){$(".view_on").removeClass("view_on");d.addClass("view_on");c(a,d.attr("id").replace("view_",""))})})};var g=function(a,c){hide="";if(!b.showTabs){hide=' style="display:none;"'}var d='<div id="filters" style="width:'+(parseInt(c,10)+2)+'px;">'+'<ul class="selections"'+hide+' id="selections"><li id="view_all" class="view_on">'+'<a onclick="return false;" href="#">View All</a></li>'+'<li id="view_selected" class=""><a onclick="return false;" href="#">Selected (<strong id="view_selected_count">0</strong>)</a></li>'+'<li id="view_unselected" class=""><a onclick="return false;" href="#">Unselected</a></li>'+'</ul><div class="clearer"></div></div>';a.before(d)};var h=function(a,b,c,d,e,f){a.children("li").wrapInner('<div class="fcbklist_item"></div>');$(".fcbklist_item").css("height",e+"px");var g=Math.ceil(parseInt(b,10)/parseInt(f,10))-11;$(".fcbklist_item").css("width",g+"px");if(!d){a.height(c+"px")}if(a.height()>c){if(d){a.height(c+"px")}g-=Math.ceil(parseInt(13,10)/parseInt(f,10))}};var i=$(this);i.css("width",b.width+"px");g(i,b.width);addAll(i,b.allBtnTxt);h(i,b.width,b.height,b.expand,b.rowHeight,b.rowItems);f(i);d(i,b.allBtnTxt);i.data("fcbkListSelection",b)})},GetSelected:function(){var a=new Array;var b=0;$.each($(this).children("li[addedid='true']"),function(c,d){d=$(d).find('input[type="hidden"]');if(d.val()){a[c-b]=d.val()}else{b++}});var c=$(this).data("fcbkListSelection");var d=$.fn.fcbkListSelection.settings.delimiter;if(c){d=c.delimiter}return a.join(d)},SetSelected:function(a){var b=$(this);var c=b.data("fcbkListSelection");var d=$.fn.fcbkListSelection.settings.delimiter;if(c){d=c.delimiter}$.each($(this).children("li"),function(e,f){f=$(f);var g=f.find('input[type="hidden"]');if(g.val()){var h=a.split(d);var i=h.length;var j=false;for(var e=0,k=i;e<k;++e){if(g.val()==h[e]){j=true;var l=f.children(".fcbklist_item");if(l.hasClass("itemselected")==false){addToSelected(b,l);l.toggleClass("itemselected");f.toggleClass("liselected")}}}if(!j){var l=f.children(".fcbklist_item");if(l.hasClass("itemselected")==true){addToSelected(b,l);l.toggleClass("itemselected");f.toggleClass("liselected");if(c){if(c.allBtnTxt){toggleAllButton(b,l.hasClass("itemselected"),c.allBtnTxt)}}}}}})}};if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.fcbkListSelection")}};$.fn.fcbkListSelection.settings={width:450,height:150,expand:true,rowHeight:15,rowItems:3,showTabs:true,allBtnTxt:null,selectAll:false,delimiter:","}})(jQuery)